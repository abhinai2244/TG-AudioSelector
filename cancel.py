# ----------------------------------------
# ğŒğ€ğƒğ„ ğğ˜ ğ€ğğ‡ğˆ
# ğ“ğ† ğˆğƒ : @ğ‚ğ‹ğ”ğ“ğ‚ğ‡ğŸğŸğŸ–
# ğ€ğğ˜ ğˆğ’ğ’ğ”ğ„ğ’ ğğ‘ ğ€ğƒğƒğˆğğ† ğŒğğ‘ğ„ ğ“ğ‡ğˆğğ†ğ¬ ğ‚ğ€ğ ğ‚ğğğ“ğ€ğ‚ğ“ ğŒğ„
# --

from pyrogram import Client, filters
# ----------------------------------------
# ğŒğ€ğƒğ„ ğğ˜ ğ€ğğ‡ğˆ
# ğ“ğ† ğˆğƒ : @ğ‚ğ‹ğ”ğ“ğ‚ğ‡ğŸğŸğŸ–
# ğ€ğğ˜ ğˆğ’ğ’ğ”ğ„ğ’ ğğ‘ ğ€ğƒğƒğˆğğ† ğŒğğ‘ğ„ ğ“ğ‡ğˆğğ†ğ¬ ğ‚ğ€ğ ğ‚ğğğ“ğ€ğ‚ğ“ ğŒğ„
# --
from pyrogram.types import Message
# ----------------------------------------
# ğŒğ€ğƒğ„ ğğ˜ ğ€ğğ‡ğˆ
# ğ“ğ† ğˆğƒ : @ğ‚ğ‹ğ”ğ“ğ‚ğ‡ğŸğŸğŸ–
# ğ€ğğ˜ ğˆğ’ğ’ğ”ğ„ğ’ ğğ‘ ğ€ğƒğƒğˆğğ† ğŒğğ‘ğ„ ğ“ğ‡ğˆğğ†ğ¬ ğ‚ğ€ğ ğ‚ğğğ“ğ€ğ‚ğ“ ğŒğ„
# --
import os
# ----------------------------------------
# ğŒğ€ğƒğ„ ğğ˜ ğ€ğğ‡ğˆ
# ğ“ğ† ğˆğƒ : @ğ‚ğ‹ğ”ğ“ğ‚ğ‡ğŸğŸğŸ–
# ğ€ğğ˜ ğˆğ’ğ’ğ”ğ„ğ’ ğğ‘ ğ€ğƒğƒğˆğğ† ğŒğğ‘ğ„ ğ“ğ‡ğˆğğ†ğ¬ ğ‚ğ€ğ ğ‚ğğğ“ğ€ğ‚ğ“ ğŒğ„
# --
import logging
# ----------------------------------------
# ğŒğ€ğƒğ„ ğğ˜ ğ€ğğ‡ğˆ
# ğ“ğ† ğˆğƒ : @ğ‚ğ‹ğ”ğ“ğ‚ğ‡ğŸğŸğŸ–
# ğ€ğğ˜ ğˆğ’ğ’ğ”ğ„ğ’ ğğ‘ ğ€ğƒğƒğˆğğ† ğŒğğ‘ğ„ ğ“ğ‡ğˆğğ†ğ¬ ğ‚ğ€ğ ğ‚ğğğ“ğ€ğ‚ğ“ ğŒğ„
# --
from utils import user_selections, safe_telegram_call, update_status_message
# ----------------------------------------
# ğŒğ€ğƒğ„ ğğ˜ ğ€ğğ‡ğˆ
# ğ“ğ† ğˆğƒ : @ğ‚ğ‹ğ”ğ“ğ‚ğ‡ğŸğŸğŸ–
# ğ€ğğ˜ ğˆğ’ğ’ğ”ğ„ğ’ ğğ‘ ğ€ğƒğƒğˆğğ† ğŒğğ‘ğ„ ğ“ğ‡ğˆğğ†ğ¬ ğ‚ğ€ğ ğ‚ğğğ“ğ€ğ‚ğ“ ğŒğ„
# --
logger = logging.getLogger(__name__)
# ----------------------------------------
# ğŒğ€ğƒğ„ ğğ˜ ğ€ğğ‡ğˆ
# ğ“ğ† ğˆğƒ : @ğ‚ğ‹ğ”ğ“ğ‚ğ‡ğŸğŸğŸ–
# ğ€ğğ˜ ğˆğ’ğ’ğ”ğ„ğ’ ğğ‘ ğ€ğƒğƒğˆğğ† ğŒğğ‘ğ„ ğ“ğ‡ğˆğğ†ğ¬ ğ‚ğ€ğ ğ‚ğğğ“ğ€ğ‚ğ“ ğŒğ„
# --

class handle_message:
    def __init__(self, client, message):
        self.client = client
        self.message = message

    def __call__(self, *args, **kwargs):
        raise NotImplementedError
    # ----------------------------------------
# ğŒğ€ğƒğ„ ğğ˜ ğ€ğğ‡ğˆ
# ğ“ğ† ğˆğƒ : @ğ‚ğ‹ğ”ğ“ğ‚ğ‡ğŸğŸğŸ–
# ğ€ğğ˜ ğˆğ’ğ’ğ”ğ„ğ’ ğğ‘ ğ€ğƒğƒğˆğğ† ğŒğğ‘ğ„ ğ“ğ‡ğˆğğ†ğ¬ ğ‚ğ€ğ ğ‚ğğğ“ğ€ğ‚ğ“ ğŒğ„
# --
# ----------------------------------------
# ğŒğ€ğƒğ„ ğğ˜ ğ€ğğ‡ğˆ
# ğ“ğ† ğˆğƒ : @ğ‚ğ‹ğ”ğ“ğ‚ğ‡ğŸğŸğŸ–
# ğ€ğğ˜ ğˆğ’ğ’ğ”ğ„ğ’ ğğ‘ ğ€ğƒğƒğˆğğ† ğŒğğ‘ğ„ ğ“ğ‡ğˆğğ†ğ¬ ğ‚ğ€ğ ğ‚ğğğ“ğ€ğ‚ğ“ ğŒğ„
# --    

def register_cancel_handlers(app: Client):
    @app.on_message(filters.command("cancel"))
    async def cancel_process(client: Client, message: Message):
        chat_id, user_id = message.chat.id, message.from_user.id
        if user_id not in user_selections.get(chat_id, {}) or not user_selections[chat_id][user_id].get('processing'):
            await safe_telegram_call(message.reply, "No active process to cancel.")
            return
        user_selections[chat_id][user_id]['processing'] = False
        path = user_selections[chat_id][user_id].get('file_path')
        if path and os.path.exists(path):
            os.remove(path)
        await safe_telegram_call(message.reply, "Process cancelled and temporary files deleted.")
        if user_selections[chat_id][user_id]['queue']:
            nxt = user_selections[chat_id][user_id]['queue'].pop(0)
            await handle_message(client, nxt)
# ----------------------------------------
# ğŒğ€ğƒğ„ ğğ˜ ğ€ğğ‡ğˆ
# ğ“ğ† ğˆğƒ : @ğ‚ğ‹ğ”ğ“ğ‚ğ‡ğŸğŸğŸ–
# ğ€ğğ˜ ğˆğ’ğ’ğ”ğ„ğ’ ğğ‘ ğ€ğƒğƒğˆğğ† ğŒğğ‘ğ„ ğ“ğ‡ğˆğğ†ğ¬ ğ‚ğ€ğ ğ‚ğğğ“ğ€ğ‚ğ“ ğŒğ„
# --
